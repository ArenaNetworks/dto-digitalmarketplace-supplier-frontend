{% extends "_base_page.html" %}
{% import "toolkit/summary-table.html" as summary %}

{% block page_title %}G-Cloud 7 updates â€“ Digital Marketplace{% endblock %}

{% block breadcrumb %}
  {%
    with items = [
      {
        "link": "/",
        "label": "Digital Marketplace",
      },
      {
        "link": url_for(".dashboard"),
        "label": "Your account",
      },
      {
        "link": url_for(".framework_dashboard"),
        "label": "Apply to G-Cloud 7",
      }
    ]
  %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block main_content %}

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      {% if message == 'message_sent' %}
        {% set message = "Your clarification message has been sent." %}
      {% endif %}
      {%
        with
        message = message,
        type = "destructive" if category == 'error' else "success"
      %}
        {% include "toolkit/notification-banner.html" %}
      {% endwith %}
    {% endfor %}
  {% endwith %}

  {% if error_message %}
    {%
      with
      errors = [
        {
            "input_name": clarification_question_name,
            "question": "Ask a G-Cloud 7 clarification question"
        }
    ],
      lede = "There was a problem with your submitted question"
    %}
      {% include "toolkit/forms/validation.html" %}
    {% endwith %}
  {% endif %}

  <div class="grid-row">
    <div class="column-two-thirds">
      {% with
         smaller = true,
         heading = "G-Cloud 7 updates"
      %}
        {% include "toolkit/page-heading.html" %}
      {% endwith %}
    </div>
  </div>

  <div class="grid-row">
    <div class="column-one-whole updates-document-tables">
      {% for section in sections %}
        {{ summary.heading(section.heading) }}
        {% call(item) summary.list_table(
          section.files,
          caption=section.heading,
          empty_message=section.empty_message,
          field_headings=[
            "Last modified",
            "File"
          ],
          field_headings_visible=False
        ) %}
          {% call summary.row() %}
            {{ summary.field_name(item.last_modified|dateformat) }}
            {% call summary.field() %}
               <a href="{{ url_for('.download_supplier_file', filepath=item.path) }}" class="document-link-with-icon">
                <span class='document-icon'>{{ item.ext }}<span> document:</span></span>
                {{ item.filename }}
              </a>
            {% endcall %}
          {% endcall %}
        {% endcall %}
      {% endfor %}
    </div>
  </div>

  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      {%
        with
        large=true,
        question = "Ask a G-Cloud 7 clarification question",
        name = clarification_question_name,
        hint = "You should ask any questions you have about G-Cloud 7 here. The Crown Commercial Service will not respond to you individually. All answers to clarification questions will be published here regularly. (Maximum 5000 characters per question.)",
        error = error_message
      %}
        {% include "toolkit/forms/textbox.html" %}
      {% endwith %}
      {%
        with
        label="Submit question",
        type="save"
      %}
        {% include "toolkit/button.html" %}
      {% endwith %}
  </form>

{% endblock %}
