{% extends "services/_base_service_page.html" %}

{% block breadcrumb %}
  {%
    with items = [
      {
        "link": "/",
        "label": "Digital Marketplace"
      },
      {
        "link": url_for(".dashboard"),
        "label": "Your account"
      },
      {
        "link": url_for(".framework_dashboard"),
        "label": "Apply to G-Cloud 7"
      },
      {
        "link": url_for(".framework_services"),
        "label": "Services"
      }
    ]
  %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block before_sections %}
<div class="column-one-third align-with-heading">
  <p class="normal-paragraph">
    <strong>Last edited</strong>
  </p>
  <p class="last-edited">
    {{ last_edit.createdAt|datetimeformat }}<br />
    by {{ last_edit.userName }}
  </p>
  {% if service_data.status == 'not-submitted' and unanswered_questions == 0 %}
    <form action="{{ url_for('.complete_draft_service', service_id=service_id) }}" method="POST">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      {% with type = "save", label = "Move to complete" %}
        {% include "toolkit/button.html" %}
      {% endwith %}
    </form>
    <p class="last-edited move-to-complete-hint">
      You can still edit services once they're complete.
    </p>
  {% elif service_data.status == 'submitted' %}
    <span class="service-status-published">Service is complete</span>
  {% else %}
    <p class="last-edited">
      {{ unanswered_questions }} question{% if unanswered_questions > 1 %}s{% endif %} unanswered
    </p>
    <p class="move-to-complete-hint">When you have added all the required information, you can move the service to complete.</p>
  {% endif %}
</div>
{% endblock %}

{% block before_heading %}
  {% if delete_requested %}
    <div class="column-one-whole">
      <form action="{{ url_for('.delete_draft_service', service_id=service_id ) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <input type="hidden" name="delete_confirmed" value="true" />
        <div class="banner-destructive-with-action">
          <p class="banner-message">
            Are you sure you want to delete this service?
          </p>
          <button class="button-destructive banner-action">Yes, delete &ldquo;{{ service_data['serviceName'] }}&rdquo;</button>
        </div>
      </form>
    </div>
  {% endif %}
{% endblock %}

{% block edit_link %}
  {{ summary.top_link("Edit", url_for(".edit_service_submission", service_id=service_id, section_id=section.id)) }}
{% endblock %}

{% block after_sections %}
  {% if not delete_requested %}
    <div class="grid-row">
      <div class="column-two-thirds">
        &nbsp;
      </div>
      <div class="column-one-third delete-draft-button">
        <form action="{{ url_for('.delete_draft_service', service_id=service_id ) }}" method="POST">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          {% with type = "destructive", label = "Delete this service" %}
            {% include "toolkit/button.html" %}
          {% endwith %}
        </form>
      </div>
    </div>
  {% endif %}
{% endblock %}
