{% extends "_base_page.html" %}
{% from 'macros/_breadcrumbs.html' import breadcrumb %}
{% block breadcrumb %}
  {%
    with items = [
      {
        "link": "/",
        "label": "Digital Marketplace"
      },
      {
        "link": url_for(".dashboard"),
        "label": current_user.supplier_name
      }
    ]
  %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}



{% block main_content %}
  <div class="grid-row">
    <div class="column-two-thirds">
      <header class="page-heading-smaller">
        {% if service_data.status != 'disabled' %}
          <p class="context">
            Edit
          </p>
        {% endif %}
        <h1>
          {{ service_data['serviceName'] }}
        </h1>
      </header>
        {% if error %}
        <div class="validation-masthead" aria-labelledby="validation-masthead-heading">
            <h3 class="validation-masthead-heading" id="validation-masthead-heading">
                {{ error }}
            </h3>
        </div>
        {% endif %}
        {% if service_data.status != 'disabled' %}
      <form action="{{ url_for('.update_service_status', service_id=service_data['id'] ) }}" method="POST">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <fieldset class="question">
          <legend class="question-heading question-heading-with-hint ">
            Choose service status
          </legend>
          <p class="hint">
            Private services don't appear in search results and don't have a
            <acronym title="Uniform resource locator">URL</acronym>
          </p>
          <label class="selection-button selection-button-boolean">
            <input type="radio" name="service_status" id="service_status_published" value="public" {% if service_data['status'] == 'published' %}checked="checked"{% endif %} />
            Public
          </label>
          <label class="selection-button  selection-button-boolean">
            <input type="radio" name="service_status" id="service_status_private" value="private" {% if service_data['status'] == 'enabled' %}checked="checked"{% endif %} />
            Private
          </label>
        </fieldset>
        <button type="submit" class="button-save">Save and return</button>
      </form>
        {% endif %}
        {% if service_data.status == 'disabled' %}
      <div class="question">
        <h2 class="question-heading service-status-removed">
          This service has been removed
        </h2>
        <p class="hint">
          If you don't know why this service has been removed, contact
          <a href="mailto:enquiries@digitalmarketplace.service.gov.uk">enquiries@digitalmarketplace.service.gov.uk</a>
        </p>
      </div>
        {% endif %}
    </div>
    <div class="column-one-whole">
      {% for section in sections %}
        {% if service_data['lot']|lower in section['depends_on_lots'] %}
          <h2 class="summary-item-heading">
            {{section.name}}
          </h2>
          {% if section.editable %}
            <p class="summary-item-top-level-action">
              <a href="#">Edit</a>
            </p>
          {% endif %}
          <table class="summary-item-body">
            <thead class="summary-item-field-headings">
              <tr>
                <th>Service attribute name</th><th>Service attribute</th>
              </tr>
            </thead>
            <tbody class="summary-item-body">
              {% for question in section.questions %}
                {% if service_data['lot']|lower in question['depends_on_lots'] %}
                  <tr class="summary-item-row">
                    <td class="summary-item-field-name">{{ question.question }}</td>
                    <td class="summary-item-field-content">
                      {% if question.type == "service_id" %}
                        {%
                          with
                          id = service_data[question.id]
                        %}
                          {% include "toolkit/service-id.html" %}
                        {% endwith %}
                      {% elif
                        question.type == "list" or
                        question.type == "checkboxes"
                      %}
                        {%
                          if service_data[question.id] is string or
                          service_data[question.id]|length == 1
                        %}
                          {{ service_data[question.id] }}
                        {% else %}
                          <ul>
                            {% for item in service_data[question.id] %}
                              <li>{{ item }}</li>
                            {% endfor %}
                          </ul>
                        {% endif %}
                      {% elif question.type == "upload" %}
                        <a href="{{ service_data[question.id].url }}">
                          {{ service_data[question.id].filename }}
                        </a>
                      {% else %}
                        {{ service_data[question.id] }}
                      {% endif %}
                    </td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      {% endfor %}
    </div>
  </div>
{% endblock %}
