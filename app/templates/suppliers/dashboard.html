{% extends "_base_page.html" %}
{% import "toolkit/summary-table.html" as summary %}

{% block page_title %}{{ current_user.supplier_name }} – Digital Marketplace{% endblock %}

{% block breadcrumb %}
  {%
    with items = [
      {
        "link": "/",
        "label": "Digital Marketplace"
      }
    ]
  %}
    {% include "toolkit/breadcrumb.html" %}
  {% endwith %}
{% endblock %}

{% block main_content %}
  <div class="grid-row">
    <div class="column-two-thirds">
      {% with
        context = current_user.email_address,
        heading = current_user.supplier_name
      %}
        {% include 'toolkit/page-heading.html' %}
      {% endwith %}
    </div>
  </div>

  {% if 'GCLOUD7_OPEN' is active_feature %}
    {% if g7_interested and g7_status == 'open' %}
      {%
        with
        items = [{
          "title": "Continue your G-Cloud 7 application",
          "link": url_for(".framework_dashboard", framework_slug='g-cloud-7'),
          "body": "Make your supplier declaration, add services and view G-Cloud 7 updates and clarification questions.",
          "subtext": "Deadline for submissions: {}".format(deadline)
        }]
      %}
        {% include "toolkit/browse-list.html" %}
      {% endwith %}
    {% elif g7_status == 'open' %}
      {%
        with
        items = [{
          "title": "Register your interest in becoming a G-Cloud 7 supplier",
          "link": url_for(".framework_dashboard", framework_slug='g-cloud-7'),
          "body": "Read about G-Cloud 7, receive email updates and start the application process.",
          "subtext": "Deadline for submissions: {}".format(deadline)
        }]
      %}
        {% include "toolkit/browse-list.html" %}
      {% endwith %}
    {% elif g7_interested and g7_application_made and g7_status == 'pending' %}
      <div class="summary-item-lede">
        <div class="grid-row">
          <div class="column-two-thirds">
            <h2 class="summary-item-heading">G-Cloud 7 is closed for applications</h2>
            <p>
              You submitted {{ g7_complete }} {{ 'service' if g7_complete == 1 else 'services' }} for consideration.
              <a href="{{ url_for('.framework_dashboard', framework_slug='g-cloud-7') }}">View your submitted application</a>
            </p>
          </div>
        </div>
      </div>
    {% elif g7_interested and g7_status == 'pending' %}
      <aside role="complementary" class="temporary-message" aria-labelledby="temporary-message-heading">
        <h2 class="temporary-message-heading" id="temporary-message-heading">
          G‑Cloud 7 is closed for applications
        </h2>
        <p class="temporary-message-message">
          You didn’t submit an application.
        </p>
        <p class="temporary-message-message">
          <a href="{{ url_for('.framework_dashboard', framework_slug='g-cloud-7') }}">View G-Cloud 7 information</a> 
        </p>
      </aside>
    {% elif g7_status == 'pending' %}
      <aside role="complementary" class="temporary-message" aria-labelledby="temporary-message-heading">
        <h2 class="temporary-message-heading" id="temporary-message-heading">
          G‑Cloud 7 is closed for applications
        </h2>
        <p class="temporary-message-message">
          Follow the <a href="https://digitalmarketplace.blog.gov.uk/">Digital Marketplace blog</a> for further G-Cloud updates.
        </p>
      </aside>
    {% endif %}
  {% endif %}

  {{ summary.heading("Current services") }}
  {% if supplier.service_counts %}
    {{ summary.top_link('View', url_for('.list_services')) }}
  {% endif %}
  {% call(item) summary.list_table(
    supplier.service_counts|dictsort,
    caption='Current services',
    field_headings=[
      'Label',
      'Value'
    ],
    field_headings_visible=False,
    empty_message="You don't have any services on the Digital Marketplace"
  ) %}
    {% call summary.row() %}
      {{ summary.field_name(item[0]) }}
      {{ summary.text(item[1]|string + " services") }}
    {% endcall %}
  {% endcall %}

  {{ summary.heading("Supplier information") }}
  {{ summary.top_link('Edit', url_for('.edit_supplier')) }}
  {% call(item) summary.mapping_table(
    caption='Supplier information',
    field_headings=[
      'Label',
      'Value'
    ],
    field_headings_visible=False
  ) %}
    {% call summary.row() %}
      {{ summary.field_name('Contact name') }}
      {{ summary.text(supplier.contact.contactName) }}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Email address') }}
      {{ summary.text(supplier.contact.email) }}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Phone number') }}
      {{ summary.text(supplier.contact.phoneNumber) }}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Website') }}
      {{ summary.text(supplier.contact.website) }}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Address') }}
      {% call summary.field() %}
        {%
          with
          without_spacing = true,
          postcode = supplier.contact.get("postcode"),
          street_address = True,
          street_address_line_1 = supplier.contact.get("address1"),
          street_address_line_2 = supplier.contact.get("address2"),
          locality = supplier.contact.get("city"),
          country = supplier.contact.get("country")
        %}
          {% include "toolkit/contact-details.html" %}
        {% endwith %}
      {% endcall %}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Supplier summary') }}
      {{ summary.text(supplier.description) }}
    {% endcall %}
    {% call summary.row() %}
      {{ summary.field_name('Clients') }}
      {{ summary.list(supplier.clients) }}
    {% endcall %}
  {% endcall %}

  {{ summary.heading("Contributors") }}
  {{ summary.top_link("Invite or remove", '/suppliers/users') }}
  {% call(item) summary.table(
    users,
    caption="Contributors",
    field_headings=[
      "Name",
      "Email address"
    ],
    field_headings_visible=False
  ) %}
    {% call summary.row() %}
      {{ summary.field_name(item.name) }}
      {{ summary.text(item.emailAddress) }}
    {% endcall %}
  {% endcall %}

  {{ summary.heading("Account information") }}
  {% call(item) summary.table(
    [
      ("Email address", current_user.email_address)
    ],
    caption="Account information",
    field_headings=[
      "Label",
      "Value"
    ],
    field_headings_visible=False
  ) %}
    {% call summary.row() %}
      {{ summary.field_name(item[0]) }}
      {{ summary.text(item[1]) }}
    {% endcall %}
  {% endcall %}

{% endblock %}
